##
# Facebook Controller
##
class App.Utils.Facebook

    ##
    # Constructor
    ##
    constructor : ->

        # Set the AJAX Cache
        # http://api.jquery.com/jQuery.ajaxSetup/

        $.ajaxSetup cache : true

        # Load the Facebook SDK Asynchronously
        # http://api.jquery.com/jQuery.getScript/

        $.getScript "//connect.facebook.net/" + locale + "/all.js", ->

            # Initialise Facebook

            FB.init

                appId      : "<%= data.config.facebookAppId %>"
                channelUrl : "<%= data.config.url %>channel.html"
                status     : true
                cookie     : true
                xfbml      : true

            # Set button states to active

            # $("#loginbutton, #feedbutton").removeAttr "disabled"

            # # authResponseChange event subscribe

            # FB.Event.subscribe "auth.authResponseChange", (response) ->

            #     log.info "Event Subscribe"

            #     # Here we specify what we do with the response anytime this event occurs.

            #     if response.status is "connected"

            #         # The response object is returned with a status field that lets the app know the current
            #         # login status of the person. In this case, we're handling the situation where they
            #         # have logged in to the app.

            #         log.info "Connected"

            #         testAPI()

            #     else if response.status is "not_authorized"

            #         # In this case, the person is logged into Facebook, but not into the app, so we call
            #         # FB.login() to prompt them to do so.
            #         # In real-life usage, you wouldn't want to immediately prompt someone to login
            #         # like this, for two reasons:
            #         # (1) JavaScript created popup windows are blocked by most browsers unless they
            #         # result from direct interaction from people using the app (such as a mouse click)
            #         # (2) it is a bad experience to be continually prompted to login upon page load.

            #         log.info "Not Authorised"

            #         FB.login()

            #     else

            #         # In this case, the person is not logged into Facebook, so we call the login()
            #         # function to prompt them to do so. Note that at this stage there is no indication
            #         # of whether they are logged into the app. If they aren't then they'll see the Login
            #         # dialog right after they log in to Facebook.
            #         # The same caveats as above apply to the FB.login() call here.

            #         log.info "Not Authorised"

            #         FB.login()

            # getLoginStatus
            # log.info FB.getLoginStatus @updateStatusCallback

    ##
    #
    ##
    updateStatusCallback : ->

        # log.info "HERE"

    ##
    # Here we run a very simple test of the Graph API after login is successful.
    # This testAPI() function is only called in those cases.
    ##
    testAPI = ->

        # log.info "Welcome!  Fetching your information.... "

        FB.api "/me", (response) ->

            # log.info "Good to see you, " + response.name + "."